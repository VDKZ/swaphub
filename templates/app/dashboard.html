{% extends "base.html" %}
{% load static %}
{% load mathfilters %}

{% block stylesheet %}
	<link rel="stylesheet" type="text/css" href="{% static 'css/dashboard.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/datatables.css' %}">
{% endblock %}


{% block body %}

<div class="container-fluid" id="container_dashboard" data-user="{{user.id}}">
	<div class="row">
			<div class="col-md-6">
				<div class="card">
					  <div class="card-header">
					    Welcome to SwapHub !
					  </div>
					  <div class="card-body" style="padding:0.5rem;">

					  	<div class="row">
		                    <div class="col-md-12">
		                        You can use the x4 mode to earn more points and get more visits on your link(s) ! <br>
		                        Enjoy !
		                    </div>
		                </div>
		            </div>
				</div>
			</div>

			<div class="col-md-6">

			<div class="card">
				<div class="card-header">
				    SwapHub stats
				</div>
				  <div class="card-body" style="padding:0.5rem;">
				  	<div class="row">
	            <div class="col-md-6">
	                <div class="card p-30">
	                    <div class="media">
	                        <div class="media-left meida media-middle">
	                            <span><i class="fa fa-bar-chart f-s-40 color-primary"></i></span>
	                        </div>
	                        <div class="media-body media-text-right">
	                            <h4>{{totalView}}</h4>
	                            <p class="m-b-0">Visits</p>
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="col-md-6">
	                <div class="card p-30">
	                    <div class="media">
	                        <div class="media-left meida media-middle">
	                            <span><i class="fa fa-hourglass-o f-s-40 color-primary"></i></span>
	                        </div>
	                        <div class="media-body media-text-right">
	                            <h4>
	                              {% if totalTime > 3600 %}
	                                {{totalTime|div:"3600"|floatformat}} hours
	                              {% elif totalTime < 360 and totalTime > 60 %}
	                                {{totalTime|div:"60"|floatformat}} min
	                              {% else %}
	                                {{totalTime|floatformat}} sec
	                              {% endif %}
	                            </h4>
	                            <p class="m-b-0">Time</p>
	                        </div>
	                    </div>
	                </div>
	            </div>
	          </div>
			</div>
			</div>
		</div>


			<div class="col-md-12" style="margin-top:30px;">
				<div class="card">
					<div class="card-header">
						Links 
					</div>
					<div class="card-body" style="overflow-x: scroll;">
						<div style="display:flex;" class="clearfix">
							{% if links|length > 3 %}
							<button id="start_4" type="button" class="btn btn-primary" style="margin-bottom:20px;">Start x4</button>
							{% endif %}
						</div>
						<div class="table-responsive">
							<table class="table table-bordered" id="datatable">
								<thead>
									<tr>
										<th class="datatable_th">Points <i class="fa fa-sort" aria-hidden="true"></i></th>
										<th class="datatable_th">Name <i class="fa fa-sort" aria-hidden="true"></i></th>
										<th class="datatable_th">URL <i class="fa fa-sort" aria-hidden="true"></i></th>
										<th class="datatable_th">Viewed <i class="fa fa-sort" aria-hidden="true"></i></th>
										<th class="datatable_th"></th>
									</tr>
								</thead>
								<tbody>
									{% for link in links %}
										<tr class="odd gradeX">
											<td class="datatable_td">{{link.user_id.points}}</td>
											<td class="datatable_td">{{link.name}}</td>
											<td class="td_url datatable_td" data-i={{forloop.counter}} data-id={{link.id}}>{{link.url}}</td>
											<td class="datatable_td">{{link.view}}</td>
											<td style="text-align:center;">
												<a data-id="{{link.id}}" data-url="{{link.url}}" class="btn btn-outline-primary view_link"><i class="fa fa-eye"></i></a>
					  							<a data-id="{{link.id}}" class="btn btn-outline-danger report_link"><i class="fa fa-exclamation "></i></a>
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

	</div>
</div>


<!-- Modal report -->
<div class="modal fade" id="reportLinkModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Report a link</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="input-group mb-3">
		  <div class="input-group-prepend">
		    <span class="input-group-text" id="inputGroup-sizing-default">Message</span>
		  </div>
		  <textarea class="form-control report_link_message" aria-label="With textarea" style="resize:vertical;max-height:400px;min-height:200px;"></textarea>
		</div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button id="btn_report_link" type="button" class="btn btn-primary">Report</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal start x4 -->
<div class="modal fade" id="browseLinkx4Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Browse links</h5>
        <button type="button" class="close stop_browse" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">


      	<div class="col-md-12" style="padding-right:30px;padding-left:30px;">
      		<div class="embed-responsive embed-responsive-16by9 z-depth-1-half main_link">
	            <iframe class="z-depth-1-half iframe_class" data-i="1" src="" allowfullscreen></iframe>
	        </div>
      	</div>

      	<div class="col-md-12" style="display:flex;margin-top:20px;margin-bottom:20px;">
      		<div class="col-md-4">
      			<div class="embed-responsive embed-responsive-16by9 z-depth-1-half waiting_div">
		            <iframe class="z-depth-1-half iframe_class" data-i="2" src="" allowfullscreen></iframe>
		        </div>
		        <div style="text-align:center;">
		       		<a class="btn btn-primary waiting_link" style="margin-top:10px;">zoom</a>
		        </div>
      		</div>
      		<div class="col-md-4">
      			<div class="embed-responsive embed-responsive-16by9 z-depth-1-half waiting_div">
		            <iframe class="z-depth-1-half waiting-link iframe_class" data-i="3" src="" allowfullscreen></iframe>
		        </div>
		        <div style="text-align:center;">
		       		<a class="btn btn-primary waiting_link" style="margin-top:10px;">zoom</a>
		        </div>
      		</div>
      		<div class="col-md-4">
      			<div class="embed-responsive embed-responsive-16by9 z-depth-1-half waiting_div">
		            <iframe class="z-depth-1-half iframe_class" src="" data-i="4" allowfullscreen></iframe>
		        </div>
		        <div style="text-align:center;">
		       		<a class="btn btn-primary waiting_link" style="margin-top:10px;">zoom</a>
		        </div>
      		</div>
      	</div>

      </div>
      <div class="modal-footer">
      	<div style="position:absolute;left:20px;">Points earned : <span id="sw_s_4">00</span> x 4 = <span id="points_4"></span> </div>
        <button id="btn_stop_browse_x4" type="button" class="btn btn-primary stop_browse" data-dismiss="modal">Stop</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal start x1 -->
<div class="modal fade" id="browseLinkx1Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Browse links</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">


      	<div class="col-md-12" style="padding-right:30px;padding-left:30px;">
      		<div class="embed-responsive embed-responsive-16by9 z-depth-1-half main_link">
	            <iframe class="z-depth-1-half" id="iframe_class_view" data-i="1" src="" allowfullscreen></iframe>
	        </div>
      	</div>

      </div>
      <div class="modal-footer">
      	<div style="position:absolute;left:20px;">Points earned : <span id="sw_s_1">00</span> x 4 = <span id="points_1"></span> </div>
        <button id="btn_stop_browse_x1" type="button" class="btn btn-primary" data-dismiss="modal">Stop</button>
      </div>
    </div>
  </div>
</div>



{% endblock %}

{% block scripts %}

	<script type="text/javascript" src="{% static 'js/datatables.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/dashboard.js' %}"></script>
	<script type="text/javascript">

	    $(document).ready(function(){
		    $('#datatable').DataTable({
		        "order": [[ 0, "desc" ]],
		        "pageLength": 50,
		        "orderable": false
		    });
		});
	</script>

{% endblock scripts %}
